# Title

Выбор хранилища данных.

## Status

Принято.

## Context

Обосновать выбор хранилища данных с учетом особенностей предметной области и платежной системы.

Предполагаемое количество пользователей: 100м.

1) Так как мы работаем с финансовыми операциями, то нам важно соблюдать принципы ACID (атомарность, согласованность, изолированность, прочность).
~~Некоторые NoSQL базы поддерживают эти принципы в той или иной мере, но все равно не на том уровне, что реляционные БД.~~
2) Поддержка ссылочной целостности и жесткой заданной схемы данных.
3) Скорость записи не так важна.

## Decision

Учитывая контекст, наш выбор пал на PostgreSQL.
1) Популярное решение.
2) Относительно простая эксплуатация.
3) В целом, выбирали по принципу «знакомства».
4) Большая часть информации не будет храниться локально.
Мы планируем использовать Stripe в качестве платежной системы. 
А, значит, что локально можно держать самый минимум: customer_id и subscriptions (лишь некоторые из полей).
Остальные данные (счета, история оплаты и т.д.) можно получить через Stripe API — не думаю, что пользователю они так часто будут нужны 
и ничего страшного не произойдет, если ему придется подождать на полсекунды дольше.

## Consequences

При большом объеме записываемых данных PostgreSQL сильно проседает в производительности.
Будет проблемой, если мы неправильно оценили кол-во возможных пользователей.


SLI: задержка выполнения запроса.

SLO: 1s.

SLA: кеширование, реплики, партицирование, шардирование. 
